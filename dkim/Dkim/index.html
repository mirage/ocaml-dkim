<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Dkim (dkim.Dkim)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../index.html">dkim</a> &#x00BB; Dkim</nav><header class="odoc-preamble"><h1>Module <code><span>Dkim</span></code></h1></header><div class="odoc-content"><div class="odoc-spec"><div class="spec module anchored" id="module-Sigs"><a href="#module-Sigs" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Sigs/index.html">Sigs</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-or_err"><a href="#type-or_err" class="anchor"></a><code><span><span class="keyword">type</span> <span>(+'a, 'err) or_err</span></span><span> = <span><span>(<span class="type-var">'a</span>, <span>[&gt; <span>`Msg of string</span> ]</span> <span class="keyword">as</span> 'err)</span> <span class="xref-unresolved">Stdlib</span>.result</span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-newline"><a href="#type-newline" class="anchor"></a><code><span><span class="keyword">type</span> newline</span><span> = </span></code><ol><li id="type-newline.CRLF" class="def variant constructor anchored"><a href="#type-newline.CRLF" class="anchor"></a><code><span>| </span><span><span class="constructor">CRLF</span></span></code></li><li id="type-newline.LF" class="def variant constructor anchored"><a href="#type-newline.LF" class="anchor"></a><code><span>| </span><span><span class="constructor">LF</span></span></code></li></ol></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-map"><a href="#type-map" class="anchor"></a><code><span><span class="keyword">type</span> map</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-signed"><a href="#type-signed" class="anchor"></a><code><span><span class="keyword">type</span> signed</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-unsigned"><a href="#type-unsigned" class="anchor"></a><code><span><span class="keyword">type</span> unsigned</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-dkim"><a href="#type-dkim" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a dkim</span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-server"><a href="#type-server" class="anchor"></a><code><span><span class="keyword">type</span> server</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-body"><a href="#type-body" class="anchor"></a><code><span><span class="keyword">type</span> body</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_dkim"><a href="#val-pp_dkim" class="anchor"></a><code><span><span class="keyword">val</span> pp_dkim : <span><span><span class="type-var">'a</span> <a href="#type-dkim">dkim</a></span> <span class="xref-unresolved">Fmt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_server"><a href="#val-pp_server" class="anchor"></a><code><span><span class="keyword">val</span> pp_server : <span><a href="#type-server">server</a> <span class="xref-unresolved">Fmt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-equal_server"><a href="#val-equal_server" class="anchor"></a><code><span><span class="keyword">val</span> equal_server : <span><a href="#type-server">server</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-server">server</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-extracted"><a href="#type-extracted" class="anchor"></a><code><span><span class="keyword">type</span> extracted</span><span> = </span><span>{</span></code><ol><li id="type-extracted.dkim_fields" class="def record field anchored"><a href="#type-extracted.dkim_fields" class="anchor"></a><code><span>dkim_fields : <span><span>(<span class="xref-unresolved">Mrmime</span>.Field_name.t * <span class="xref-unresolved">Unstrctrd</span>.t * <a href="#type-map">map</a>)</span> list</span>;</span></code></li><li id="type-extracted.fields" class="def record field anchored"><a href="#type-extracted.fields" class="anchor"></a><code><span>fields : <span><span>(<span class="xref-unresolved">Mrmime</span>.Field_name.t * <span class="xref-unresolved">Unstrctrd</span>.t)</span> list</span>;</span></code></li><li id="type-extracted.prelude" class="def record field anchored"><a href="#type-extracted.prelude" class="anchor"></a><code><span>prelude : string;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-extract_dkim"><a href="#val-extract_dkim" class="anchor"></a><code><span><span class="keyword">val</span> extract_dkim : 
  <span><span class="optlabel">?newline</span>:<a href="#type-newline">newline</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?size</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'flow</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'t</span> <a href="Sigs/index.html#type-state">Sigs.state</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="keyword">module</span> <a href="Sigs/module-type-FLOW/index.html">Sigs.FLOW</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="Sigs/module-type-FLOW/index.html#type-backend">backend</a> = <span class="type-var">'t</span> <span class="keyword">and</span> <span class="keyword">type</span> <a href="Sigs/module-type-FLOW/index.html#type-flow">flow</a> = <span class="type-var">'flow</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><span>(<a href="#type-extracted">extracted</a>, <span class="type-var">_</span>)</span> <a href="#type-or_err">or_err</a></span>, <span class="type-var">'t</span>)</span> <a href="Sigs/index.html#type-io">Sigs.io</a></span></span></code></div><div class="spec-doc"><p><code>extract_dkim ?newline flow state (module Flow)</code> reads <code>flow</code> with Input/Output scheduler represented by <code>state</code> and primitives implemented by <code>(module Flow)</code>. <code>?newline</code> specifies kind of contents (<code>CRLF</code> from network or <code>LF</code> from database like <i>maildir</i>).</p><p>It tries to extract <code>DKIM-Signature</code> fields with values, others fields and give a prelude of the body of the email (given by <code>flow</code>).</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-post_process_dkim"><a href="#val-post_process_dkim" class="anchor"></a><code><span><span class="keyword">val</span> post_process_dkim : <span><a href="#type-map">map</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><a href="#type-signed">signed</a> <a href="#type-dkim">dkim</a></span>, <span class="type-var">_</span>)</span> <a href="#type-or_err">or_err</a></span></span></code></div><div class="spec-doc"><p><code>post_process_dkim map</code> from an already parsed <code>DKIM-Signature</code> represented by <a href="#type-map"><code>map</code></a>, we compute a post process analyze (check required/optional well formed values) and return a safe representation of <code>DKIM-Signature</code>, <a href="#type-dkim"><code>dkim</code></a>, which can be used by <a href="#val-verify"><code>verify</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-selector"><a href="#val-selector" class="anchor"></a><code><span><span class="keyword">val</span> selector : <span><span><span class="type-var">'a</span> <a href="#type-dkim">dkim</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>[ `raw ]</span> <span class="xref-unresolved">Domain_name</span>.t</span></span></code></div><div class="spec-doc"><p><code>selector dkim</code> returns the selector of the DKIM-Signature field.</p><p>Selectors might indicate the names of office locations, the signing date, or even an individual user.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-domain"><a href="#val-domain" class="anchor"></a><code><span><span class="keyword">val</span> domain : <span><span><span class="type-var">'a</span> <a href="#type-dkim">dkim</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>[ `raw ]</span> <span class="xref-unresolved">Domain_name</span>.t</span></span></code></div><div class="spec-doc"><p><code>domain dkim</code> returns the domain which signed the mail.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-fields"><a href="#val-fields" class="anchor"></a><code><span><span class="keyword">val</span> fields : <span><span><span class="type-var">'a</span> <a href="#type-dkim">dkim</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Mrmime</span>.Field_name.t list</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-domain_name"><a href="#val-domain_name" class="anchor"></a><code><span><span class="keyword">val</span> domain_name : 
  <span><span><span class="type-var">'a</span> <a href="#type-dkim">dkim</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><span>[ `raw ]</span> <span class="xref-unresolved">Domain_name</span>.t</span>, <span>[&gt; <span>`Msg of string</span> ]</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span></span></code></div><div class="spec-doc"><p><code>domain_name dkim</code> returns the full domain-name where the DNS TXT record can be get.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-extract_server"><a href="#val-extract_server" class="anchor"></a><code><span><span class="keyword">val</span> extract_server : 
  <span><span class="type-var">'t</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'backend</span> <a href="Sigs/index.html#type-state">Sigs.state</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="keyword">module</span> <a href="Sigs/module-type-DNS/index.html">Sigs.DNS</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="Sigs/module-type-DNS/index.html#type-backend">backend</a> = <span class="type-var">'backend</span> <span class="keyword">and</span> <span class="keyword">type</span> <a href="Sigs/module-type-DNS/index.html#type-t">t</a> = <span class="type-var">'t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="#type-dkim">dkim</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><span>(<a href="#type-map">map</a>, <span class="type-var">_</span>)</span> <a href="#type-or_err">or_err</a></span>, <span class="type-var">'backend</span>)</span> <a href="Sigs/index.html#type-io">Sigs.io</a></span></span></code></div><div class="spec-doc"><p><code>extract_server dns state (module Dns) dkim</code> gets public-key noticed by <code>dkim</code> from authority server over DNS protocol (with Input/Output scheduler represented by <code>state</code> and primitives implemented by <code>(module Dns)</code>).</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-post_process_server"><a href="#val-post_process_server" class="anchor"></a><code><span><span class="keyword">val</span> post_process_server : <span><a href="#type-map">map</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<a href="#type-server">server</a>, <span class="type-var">_</span>)</span> <a href="#type-or_err">or_err</a></span></span></code></div><div class="spec-doc"><p><code>post_process_server map</code> from an already parsed TXT record (given by a DNS service) represented by <a href="#type-map"><code>map</code></a>, we compute a post-process analyze (check required/optional well formed values) and return a safe representation of the public-key, <a href="#type-server"><code>server</code></a>, which can be used by <a href="#val-verify"><code>verify</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-extract_body"><a href="#val-extract_body" class="anchor"></a><code><span><span class="keyword">val</span> extract_body : 
  <span><span class="optlabel">?newline</span>:<a href="#type-newline">newline</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'flow</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'backend</span> <a href="Sigs/index.html#type-state">Sigs.state</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="keyword">module</span> <a href="Sigs/module-type-FLOW/index.html">Sigs.FLOW</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="Sigs/module-type-FLOW/index.html#type-backend">backend</a> = <span class="type-var">'backend</span> <span class="keyword">and</span> <span class="keyword">type</span> <a href="Sigs/module-type-FLOW/index.html#type-flow">flow</a> = <span class="type-var">'flow</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">prelude</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">simple</span>:<span>(<span><span>string option</span> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">relaxed</span>:<span>(<span><span>string option</span> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span>
  <span>[ <span>`Consume of <span><span>(unit, <span class="type-var">'backend</span>)</span> <a href="Sigs/index.html#type-io">Sigs.io</a></span></span> ]</span></span></code></div><div class="spec-doc"><p><code>extract_body ?newline flow state (module Flow) ~prelude</code> extracts a thin representation of the body of the email. It should follow <a href="#val-extract_dkim"><code>extract_dkim</code></a> with <code>prelude</code> and with <code>flow</code>, <code>state</code>, <code>(module Flow)</code> and <code>?newline</code> arguments. It returns a <a href="#type-body"><code>body</code></a> which can be used by <a href="#val-verify"><code>verify</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-expired"><a href="#val-expired" class="anchor"></a><code><span><span class="keyword">val</span> expired : <span><span class="label">epoch</span>:<span>(<span>unit <span class="arrow">&#45;&gt;</span></span> int64)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="#type-signed">signed</a> <a href="#type-dkim">dkim</a></span> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p><code>expired ~epoch dkim</code> returns <code>true</code> if the signature is expired. <code>verify</code> with the given <code>dkim</code> will returns <code>true</code> but it does not process the real verification, which will obviously fails otherwise due to the obsolete public/private key available by the signer.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-stream"><a href="#type-stream" class="anchor"></a><code><span><span class="keyword">type</span> <span>('a, 'backend) stream</span></span><span> = <span>unit <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="type-var">'a</span> option</span>, <span class="type-var">'backend</span>)</span> <a href="Sigs/index.html#type-io">Sigs.io</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-verify"><a href="#val-verify" class="anchor"></a><code><span><span class="keyword">val</span> verify : 
  <span><span><span class="type-var">'backend</span> <a href="Sigs/index.html#type-state">Sigs.state</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">epoch</span>:<span>(<span>unit <span class="arrow">&#45;&gt;</span></span> int64)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="xref-unresolved">Mrmime</span>.Field_name.t * <span class="xref-unresolved">Unstrctrd</span>.t)</span> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="xref-unresolved">Mrmime</span>.Field_name.t * <span class="xref-unresolved">Unstrctrd</span>.t)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">simple</span>:<span><span>(string, <span class="type-var">'backend</span>)</span> <a href="#type-stream">stream</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">relaxed</span>:<span><span>(string, <span class="type-var">'backend</span>)</span> <a href="#type-stream">stream</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-signed">signed</a> <a href="#type-dkim">dkim</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-server">server</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(bool, <span class="type-var">'backend</span>)</span> <a href="Sigs/index.html#type-io">Sigs.io</a></span></span></code></div><div class="spec-doc"><p><code>verify fields (dkim_field_name, dkim_value) dkim server body</code> verifies the given email (represented by <a href="#type-body"><code>body</code></a>. <code>fields</code> and <code>(dkim_field_name, dkim_value)</code>) with a signature <a href="#type-dkim"><code>dkim</code></a> and the public-key represented by <a href="#type-server"><code>server</code></a>.</p><p>It returns <code>true</code> if signature is correct or <code>false</code> if something is wrong.</p><p>Establishing the exact cause of a failed verification if difficult:</p><ul><li><code>selector</code> can not be found.</li><li>Public-key was updated.</li><li><code>DKIM-Signature</code> is not well-formed.</li><li>etc.</li></ul><p>At least, <code>dkim</code> provides some logs to highlight where the verification failed. Finally, the given email should be treated the same as all unverified email - regardless of whether or not it looks like it was signed.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-algorithm"><a href="#type-algorithm" class="anchor"></a><code><span><span class="keyword">type</span> algorithm</span><span> = </span><span>[ </span></code><ol><li id="type-algorithm.RSA" class="def variant constructor anchored"><a href="#type-algorithm.RSA" class="anchor"></a><code><span>| </span><span>`RSA</span></code></li></ol><code><span> ]</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-hash"><a href="#type-hash" class="anchor"></a><code><span><span class="keyword">type</span> hash</span><span> = </span><span>[ </span></code><ol><li id="type-hash.SHA1" class="def variant constructor anchored"><a href="#type-hash.SHA1" class="anchor"></a><code><span>| </span><span>`SHA1</span></code></li><li id="type-hash.SHA256" class="def variant constructor anchored"><a href="#type-hash.SHA256" class="anchor"></a><code><span>| </span><span>`SHA256</span></code></li></ol><code><span> ]</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-canonicalization"><a href="#type-canonicalization" class="anchor"></a><code><span><span class="keyword">type</span> canonicalization</span><span> = </span><span>[ </span></code><ol><li id="type-canonicalization.Simple" class="def variant constructor anchored"><a href="#type-canonicalization.Simple" class="anchor"></a><code><span>| </span><span>`Simple</span></code></li><li id="type-canonicalization.Relaxed" class="def variant constructor anchored"><a href="#type-canonicalization.Relaxed" class="anchor"></a><code><span>| </span><span>`Relaxed</span></code></li></ol><code><span> ]</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-query"><a href="#type-query" class="anchor"></a><code><span><span class="keyword">type</span> query</span><span> = </span><span>[ </span></code><ol><li id="type-query.DNS" class="def variant constructor anchored"><a href="#type-query.DNS" class="anchor"></a><code><span>| </span><span>`DNS <span class="keyword">of</span> <span>[ `TXT ]</span></span></code></li></ol><code><span> ]</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-v"><a href="#val-v" class="anchor"></a><code><span><span class="keyword">val</span> v : 
  <span><span class="optlabel">?version</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?fields</span>:<span><span class="xref-unresolved">Mrmime</span>.Field_name.t list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">selector</span>:<span><span>[ `raw ]</span> <span class="xref-unresolved">Domain_name</span>.t</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?algorithm</span>:<a href="#type-algorithm">algorithm</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?hash</span>:<a href="#type-hash">hash</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?canonicalization</span>:<span>(<a href="#type-canonicalization">canonicalization</a> * <a href="#type-canonicalization">canonicalization</a>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?length</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?query</span>:<a href="#type-query">query</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?timestamp</span>:int64 <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?expiration</span>:int64 <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>[ `raw ]</span> <span class="xref-unresolved">Domain_name</span>.t</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-unsigned">unsigned</a> <a href="#type-dkim">dkim</a></span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Encoder"><a href="#module-Encoder" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Encoder/index.html">Encoder</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-sign"><a href="#val-sign" class="anchor"></a><code><span><span class="keyword">val</span> sign : 
  <span><span class="label">key</span>:<span class="xref-unresolved">Mirage_crypto_pk</span>.Rsa.priv <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?newline</span>:<a href="#type-newline">newline</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'flow</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'t</span> <a href="Sigs/index.html#type-state">Sigs.state</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">both</span>:<span><span class="type-var">'t</span> <a href="Sigs/index.html#type-both">Sigs.both</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="keyword">module</span> <a href="Sigs/module-type-FLOW/index.html">Sigs.FLOW</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="Sigs/module-type-FLOW/index.html#type-backend">backend</a> = <span class="type-var">'t</span> <span class="keyword">and</span> <span class="keyword">type</span> <a href="Sigs/module-type-FLOW/index.html#type-flow">flow</a> = <span class="type-var">'flow</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="keyword">module</span> <a href="Sigs/module-type-STREAM/index.html">Sigs.STREAM</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="Sigs/module-type-STREAM/index.html#type-backend">backend</a> = <span class="type-var">'t</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="#type-unsigned">unsigned</a> <a href="#type-dkim">dkim</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><a href="#type-signed">signed</a> <a href="#type-dkim">dkim</a></span>, <span class="type-var">'t</span>)</span> <a href="Sigs/index.html#type-io">Sigs.io</a></span></span></code></div><div class="spec-doc"><p><code>sign ~key ~newline flow state (module Flow) dkim</code> returns a signed <a href="#type-dkim"><code>dkim</code></a> value which can be serialized into the given email (represented by <code>flow</code>). According to <code>dkim</code>, it will sign some fields and the body.</p><p>The returned signed <a href="#type-dkim"><code>dkim</code></a> can be serialized with:</p><pre class="language-ocaml"><code>let dkim_field = Prettym.to_string Dkim.Encoder.as_field dkim</code></pre></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-server_of_dkim"><a href="#val-server_of_dkim" class="anchor"></a><code><span><span class="keyword">val</span> server_of_dkim : <span><span class="label">key</span>:<span class="xref-unresolved">Mirage_crypto_pk</span>.Rsa.priv <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-dkim">dkim</a></span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-server">server</a></span></code></div><div class="spec-doc"><p><code>server_of_dkim</code> returns the required server value from a <a href="#type-dkim"><code>dkim</code></a> value. The user is able to store the associated server value into the DNS TXT record with <a href="#val-server_to_string"><code>server_to_string</code></a> such as:</p><pre class="language-ocaml"><code>let str = Dkim.server_to_string (Dkim.server_of_dkim ~key dkim) in
nsupdate (Dkim.domain_name dkim) `TXT str</code></pre></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-server_to_string"><a href="#val-server_to_string" class="anchor"></a><code><span><span class="keyword">val</span> server_to_string : <span><a href="#type-server">server</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p><code>server_to_string server</code> generates a <code>string</code> from the given <code>server</code> value to be able to store the string into the DNS TXT record.</p></div></div><p>/</p><div class="odoc-spec"><div class="spec value anchored" id="val-remove_signature_of_raw_dkim"><a href="#val-remove_signature_of_raw_dkim" class="anchor"></a><code><span><span class="keyword">val</span> remove_signature_of_raw_dkim : <span><span class="xref-unresolved">Unstrctrd</span>.t <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Unstrctrd</span>.t</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-relaxed_field_canonicalization"><a href="#val-relaxed_field_canonicalization" class="anchor"></a><code><span><span class="keyword">val</span> relaxed_field_canonicalization : 
  <span><span class="xref-unresolved">Mrmime</span>.Field_name.t <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Unstrctrd</span>.t <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span>string <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Body"><a href="#module-Body" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Body/index.html">Body</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-parse_dkim_field_value"><a href="#val-parse_dkim_field_value" class="anchor"></a><code><span><span class="keyword">val</span> parse_dkim_field_value : 
  <span><span class="xref-unresolved">Unstrctrd</span>.t <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="#type-map">map</a>, <span>[&gt; <span>`Msg of string</span> ]</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-field_dkim_signature"><a href="#val-field_dkim_signature" class="anchor"></a><code><span><span class="keyword">val</span> field_dkim_signature : <span class="xref-unresolved">Mrmime</span>.Field_name.t</span></code></div></div></div></body></html>
